import axios from "axios";
import dotenv from "dotenv";

dotenv.config();

const SPOTIFY_API_URL = "https://api.spotify.com/v1";
const SPOTIFY_TOKEN_URL = "https://accounts.spotify.com/api/token";

const getAccessToken = async () => {
  const auth = Buffer.from(
    process.env.SPOTIFY_CLIENT_ID + ":" + process.env.SPOTIFY_SECRET,
  ).toString("base64");
  const res = await axios.post(
    `${SPOTIFY_TOKEN_URL}`,
    {
      grant_type: "client_credentials",
    },
    {
      headers: {
        Authorization: `Basic ${auth}`,
        "Content-Type": "application/x-www-form-urlencoded",
      },
    },
  );

  return res.data.access_token;
};

export const getTopKpopArtists = async () => {
  try {
    const accessToken = await getAccessToken();
    const res = await axios.get(
      `${SPOTIFY_API_URL}/search?q=genre%3Dkpop&type=artist&limit=20`,
      {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      },
    );
    console.log(res.data);
    const artists = res.data.artists.items;
    const result = artists.map((artist) => artist.name);
    console.log(result);
  } catch (e) {
    console.log(e);
  }
};

getTopKpopArtists();
